#! /usr/bin/make -f
# -*- makefile; coding: utf-8 -*-
#
# debian/rules
#
# Copyright Â© 2008 Ben Finney <ben@benfinney.id.au>
# This is free software; you may copy, modify and/or distribute this work
# under the terms of the GNU General Public License, version 2 or later.
# No warranty expressed or implied.
# See the file '/usr/share/common-licenses/GPL-2' for details.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

PACKAGE_NAME = python-minimock
MODULE_NAME = MiniMock

PYTHON_VERSIONS = $(shell pyversions -r debian/control)
CURRENT_PYTHON_VERSION = $(shell pyversions -d)
CURRENT_PYTHON_VERSION_NUMBER = $(shell pyversions -dv)

site_packages_dir = $(CURDIR)/debian/${PACKAGE_NAME}/usr/lib/${CURRENT_PYTHON_VERSION}/site-packages
upstream_basename = ${MODULE_NAME}-${DEB_UPSTREAM_VERSION}

DEB_UPSTREAM_VERSION = $(shell dpkg-parsechangelog \
        | grep '^Version:' | cut -d ' ' -f 2 \
        | cut -d '-' -f 1)
DEB_PYTHON_INSTALL_ARGS_ALL += --root $(CURDIR)/debian/${PACKAGE_NAME}


.PHONY: build
build:
	dh build

.PHONY: clean
clean:
	dh clean

.PHONY: install
install: build
	dh install --until installdirs
	$(CURRENT_PYTHON_VERSION) setup.py install ${DEB_PYTHON_INSTALL_ARGS_ALL}
	dh install --before pysupport
	dh install --after pysupport

.PHONY: binary-indep
binary-indep: build install
	dh binary-indep --before pysupport
	dh_pycentral
	dh binary-indep --after pysupport

.PHONY: binary-arch
binary-arch: build install

.PHONY: binary
binary: build binary-indep binary-arch
